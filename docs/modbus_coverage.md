# Neptun Smart Modbus Coverage

Источник сверки: `docs/modbus_registers.xlsx`.

## DONE

- Регистр `0` (конфигурация/статус модуля):
  - чтение основных флагов;
  - запись управляющих битов через `switch`:
    - зона 1, зона 2, зона 1+2;
    - dual zone;
    - floor washing;
    - keypad lock;
    - close taps on sensor lost;
    - add new sensor (pairing).
- Регистр `3` (статус проводных линий):
  - чтение `LeakSensor N` (автодетект количества линий).
- Регистр `6` (кол-во беспроводных датчиков):
  - чтение и автодетект беспроводных датчиков.
- Регистры `57..106` (статус беспроводных датчиков):
  - чтение raw/тревога/потеря/категория/уровень сигнала/батарея.
- Регистры `107..122` (показания счетчиков):
  - чтение 8 счетчиков (`int32`, масштаб `0.001 м³`);
  - запись для калибровки текущего значения (`number`: `Counter N Calibration`).
- Регистры `123..130` (настройки счетчиков):
  - чтение шага, статуса, connection type, namur error;
  - запись шага счета (`select`: `Counter N Step`, варианты `1/10/100`);
  - запись типа подключения (`select`: `Counter N Connection Type`);
  - запись статуса (`switch`: `Counter N Enabled`).
- Регистры `1` и `2` (конфигурация входов линий):
  - чтение/запись типа входа линии (`select`: `Line N Input Type`);
  - чтение/запись группы кранов линии (`select`: `Line N Valve Group`).
- Регистр `4` (конфигурация реле событий):
  - чтение/запись групп для тревоги и закрытия кранов (`select`).
- Регистр `5` (адрес Modbus и скорость порта):
  - чтение/запись адреса модуля (`number`: `Modbus Address`);
  - чтение/запись скорости порта (`select`: `Modbus Baud Rate`).
- Регистры `7..56` (параметры беспроводных датчиков):
  - чтение/запись группы отработки событий для обнаруженных датчиков (`select`: `Wireless Sensor N Group`).
- Регистр `0`, биты `5` и `6`:
  - чтение (`binary_sensor`) и запись (`switch`) флагов закрытия групп 1/2 при потере беспроводных датчиков.
- Автодетект установленных счетчиков:
  - по биту статуса в регистрах `123..130`;
  - создание counter-сущностей только для обнаруженных модулей.
- Диагностическая разметка:
  - служебные сущности вынесены в `diagnostic` и отключены по умолчанию.

## TODO

- Добавить явные diagnostics-сенсоры `raw` для регистров `1`, `2`, `4`, `5` (сейчас доступ к значениям идёт через настроечные `select/number` сущности).
- При необходимости добавить управление параметрами беспроводных датчиков `7..56` не только для обнаруженных, но и принудительно для всех `1..50`.
